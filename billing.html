<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Billing System - Narayan Kirana Store</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: linear-gradient(to right, #fceabb, #f8b500); }
    .container { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px 25px; border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
    .header-top { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; color: #555; }
    h1 { text-align: center; margin: 6px 0; color: #ff6f61; font-size: 32px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
    h2 { text-align: center; color: #007bff; margin: 12px 0; text-decoration: underline; }
    h3 { text-align: center; margin: 4px 0; color: #555; font-size: 16px; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 12px; }
    label { min-width: 60px; font-weight: bold; color: #333; }
    input, select { padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    input:focus, select:focus { outline: none; border-color: #007bff; box-shadow: 0 0 5px rgba(0,123,255,0.5); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 13px; }
    table, th, td { border: 1px solid #ccc; }
    th { background: linear-gradient(to right, #4facfe, #00f2fe); color: #fff; font-size: 14px; }
    th, td { padding: 8px; text-align: center; }
    .btn { padding: 6px 12px; cursor: pointer; border: none; border-radius: 6px; transition: 0.3s; font-weight: bold; font-size: 13px; }
    .btn:hover { opacity: 0.85; }
    .removeBtn { background-color: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; }
    .removeBtn:hover { background-color: #c0392b; }
    .actions { margin-top: 12px; display:flex; gap:10px; justify-content:flex-end; flex-wrap: wrap; }

    @media(max-width: 768px) {
      .row { flex-direction: column; align-items: flex-start; }
      input, select { width: 100%; }
      .actions { justify-content: center; }
    }

    @media print {
      body { background: #fff; margin: 0; }
      .no-print, .add-item-row, .action-col, .header-top a { display: none; }
      .container { width: 210mm; height: 297mm; padding: 15mm; box-sizing: border-box; }
      table { font-size: 11px; page-break-inside: avoid; }
      tr { page-break-inside: avoid; page-break-after: auto; }
      .print-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-top">
      <div>GST No: 09CXYPD4494C1ZZ | Address: Main Trimuhani, Gyanpur, Bhadohi</div>
      <div>Mobile: 9935113436, 9935113340</div>
    </div>
    <h1>Narayan Kirana Store</h1>
    <h2>Billing System</h2>

    <div class="row" style="background: #f1f8ff; padding: 12px 10px; border-radius: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
      <div style="flex:1; display:flex; gap:8px; align-items:center;"><label for="custName">Name:</label><input type="text" id="custName" aria-label="Customer Name" /></div>
      <div style="flex:2; display:flex; gap:8px; align-items:center;"><label for="custAddress">Address:</label><input type="text" id="custAddress" aria-label="Customer Address" style="flex:1;" /></div>
      <div style="flex:1; display:flex; gap:8px; align-items:center;"><label for="billDate">Date:</label><input type="date" id="billDate" aria-label="Bill Date" /></div>
    </div>

    <h3>Add Item</h3>
    <div class="row add-item-row">
      <label for="itemName">Item:</label>
      <input type="text" id="itemName" aria-label="Item Name" />
      <label for="qty">Qty:</label>
      <input type="number" id="qty" min="0" step="any" style="width:100px;" aria-label="Quantity" />
      <select id="unit" aria-label="Unit">
        <option value="kg">Kg</option>
        <option value="gm">Gram</option>
        <option value="liter">Liter</option>
        <option value="packet">Packet</option>
        <option value="piece">Piece</option>
      </select>
      <label for="rate">Rate:</label>
      <input type="number" id="rate" min="0" step="any" style="width:120px;" aria-label="Rate" />
      <button class="btn" onclick="addItem()" aria-label="Add Item" style="background-color:#007bff;color:white;">Add</button>
    </div>

    <table id="billTable" aria-label="Billing Table">
      <thead>
        <tr>
          <th>Sr No.</th>
          <th>Item Name</th>
          <th>Quantity</th>
          <th>Rate</th>
          <th>Total</th>
          <th class="action-col">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="actions no-print">
      <button class="btn" onclick="updateGrandTotal()" style="background:#28a745;color:white;">Calculate Total</button>
      <button class="btn" onclick="window.print()" style="background:#17a2b8;color:white;">Print Bill</button>
      <button class="btn" onclick="saveAsPDF()" style="background:#6f42c1;color:white;">Save as PDF</button>
    </div>

    <h3>Total Amount: <span id="grandTotal">0</span></h3>
  </div>

  <script>
    (function setDate() {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      document.getElementById('billDate').value = `${yyyy}-${mm}-${dd}`;
    })();

    function addItem() {
      const rows = document.querySelectorAll('#billTable tbody tr');
      if (rows.length >= 100) { alert('Maximum 100 items allowed per bill.'); return; }
      const name = document.getElementById('itemName').value.trim();
      const qty = parseFloat(document.getElementById('qty').value);
      const unit = document.getElementById('unit').value;
      const rate = parseFloat(document.getElementById('rate').value);
      if (!name || isNaN(qty) || isNaN(rate) || qty <= 0 || rate <= 0) { alert('Enter valid item, quantity, and rate'); return; }
      const total = +(qty * rate).toFixed(2);
      const row = document.createElement('tr');
      row.innerHTML = `<td></td><td>${name}</td><td>${qty} ${unit}</td><td>${rate.toFixed(2)}</td><td>${total.toFixed(2)}</td><td class='action-col'><button class='removeBtn' onclick='removeItem(this)'>Remove</button></td>`;
      document.querySelector('#billTable tbody').appendChild(row);
      updateSerialNumbers(); updateGrandTotal();
      document.getElementById('itemName').value = ''; document.getElementById('qty').value = ''; document.getElementById('rate').value = '';
      document.getElementById('itemName').focus();
    }

    document.getElementById('rate').addEventListener('keypress', e => { if(e.key==='Enter') addItem(); });
    function updateSerialNumbers(){ document.querySelectorAll('#billTable tbody tr').forEach((r,i)=>r.children[0].textContent=i+1); }
    function removeItem(btn){ const row=btn.closest('tr'); if(!row) return; if(!confirm('Remove this item?')) return; row.remove(); updateSerialNumbers(); updateGrandTotal(); }
    function updateGrandTotal(){ let total=0; document.querySelectorAll('#billTable tbody tr').forEach(r=>{ total+=parseFloat(r.children[4].textContent)||0; }); document.getElementById('grandTotal').textContent=total.toFixed(2); }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    function saveAsPDF() {
      const element = document.querySelector('.container');
      const custName = document.getElementById('custName').value.trim() || 'bill';
      const billDate = document.getElementById('billDate').value || new Date().toISOString().split('T')[0];
      html2pdf().from(element).set({ margin:10, filename:`${custName}_${billDate}.pdf`, image:{type:'jpeg',quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'mm',format:'a4',orientation:'portrait'} }).save();
    }
  </script>
</body>
</html>
